<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <title>Ordem de Serviço</title>
    <style>
        @page {
            size: A4;
            margin: 15mm;

            @bottom-center {
                content: "Página " counter(page) " de " counter(pages);
                font-size: 9pt;
                color: #666;
            }
        }

        body {
            font-family: sans-serif;
            font-size: 10pt;
            color: #333;
        }

        .header {
            border-bottom: 2px solid #FFD700;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .logo {
            width: 120px !important;
            height: 50px !important;
            max-width: 120px !important;
            max-height: 50px !important;
            object-fit: contain;
        }

        .company-info {
            text-align: right;
            font-size: 8pt;
            color: #666;
        }

        .company-name {
            font-size: 14pt;
            font-weight: bold;
            color: #000;
        }

        .os-title {
            text-align: center;
            margin-bottom: 20px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
        }

        .os-title h1 {
            margin: 0;
            font-size: 16pt;
        }

        .os-number {
            font-size: 20pt;
            color: #333;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 10pt;
            font-weight: bold;
            margin-top: 8px;
        }

        .status-ABERTA {
            background: #ffc107;
            color: #000;
        }

        .status-EM_EXECUCAO {
            background: #17a2b8;
            color: #fff;
        }

        .status-FINALIZADA {
            background: #28a745;
            color: #fff;
        }

        .status-CANCELADA {
            background: #dc3545;
            color: #fff;
        }

        .section-title {
            font-size: 11pt;
            font-weight: bold;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
            margin-top: 20px;
            margin-bottom: 10px;
            color: #444;
        }

        .info-box {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 4px;
        }

        .info-row {
            margin-bottom: 4px;
        }

        .info-label {
            font-weight: bold;
            color: #555;
            width: 120px;
            display: inline-block;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }

        th {
            background: #333;
            color: #FFD700;
            padding: 8px;
            text-align: left;
            font-size: 9pt;
        }

        td {
            border-bottom: 1px solid #eee;
            padding: 8px;
            font-size: 9pt;
        }

        .text-right {
            text-align: right;
        }

        .text-center {
            text-align: center;
        }

        .veiculo-header {
            background: #e9ecef;
            font-weight: bold;
        }

        .subtotal-row td {
            background: #f8f9fa;
            font-weight: bold;
        }

        .total-box {
            background: #333;
            color: #fff;
            padding: 15px;
            margin-top: 20px;
            break-inside: avoid;
        }

        .total-row {
            display: table;
            width: 100%;
            margin-bottom: 8px;
        }

        .total-label {
            display: table-cell;
            font-size: 10pt;
        }

        .total-value {
            display: table-cell;
            text-align: right;
            font-size: 10pt;
        }

        .total-final {
            border-top: 1px solid #FFD700;
            padding-top: 10px;
            margin-top: 10px;
        }

        .total-final .total-label,
        .total-final .total-value {
            font-size: 14pt;
            font-weight: bold;
            color: #FFD700;
        }

        .discount-row {
            color: #dc3545;
        }

        .footer {
            font-size: 8pt;
            color: #999;
            text-align: center;
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }
    </style>
</head>

<body>
    <!-- Header com Logo e Dados da Empresa -->
    <div class="header">
        <table style="width: 100%; border: none;">
            <tr style="border: none;">
                <td style="width: 40%; border: none; padding: 0;">
                    <img th:if="${empresa['hasLogo']}" th:src="${empresa['logoUrl']}" class="logo" width="120"
                        height="50" style="width: 120px !important; height: 50px !important;" />
                    <div th:unless="${empresa['hasLogo']}" class="company-name" th:text="${empresa['razaoSocial']}">
                        Empresa</div>
                </td>
                <td style="width: 60%; text-align: right; border: none; padding: 0;">
                    <div class="company-name" th:if="${empresa['hasLogo']}" th:text="${empresa['razaoSocial']}">Nome da
                        Empresa</div>
                    <div class="company-info">
                        <div th:text="${empresa['cnpj']}">CNPJ</div>
                        <div th:text="${empresa['endereco']}">Endereço</div>
                        <div>
                            <span th:text="${empresa['telefone']}">Telefone</span>
                            <span th:if="${empresa['email']}"> | </span>
                            <span th:text="${empresa['email']}">Email</span>
                        </div>
                    </div>
                </td>
            </tr>
        </table>
    </div>

    <!-- Título da OS com Status -->
    <div class="os-title">
        <h1>ORDEM DE SERVIÇO</h1>
        <div class="os-number" th:text="'Nº ' + ${os.id}">Nº 1</div>
        <div th:class="'status-badge status-' + ${os.status}" th:text="${statusDescricao}">Status</div>
        <div style="font-size: 9pt; color: #666; margin-top: 8px;">
            Data: <span th:text="${#temporals.format(os.data, 'dd/MM/yyyy')}">01/01/2026</span>
        </div>
    </div>

    <!-- Dados do Cliente -->
    <div class="section-title">Dados do Cliente</div>
    <div class="info-box">
        <div class="info-row">
            <span class="info-label">Razão Social:</span>
            <span th:text="${os.cliente.razaoSocial}">Cliente Exemplo LTDA</span>
        </div>
        <div class="info-row" th:if="${os.cliente.nomeFantasia}">
            <span class="info-label">Nome Fantasia:</span>
            <span th:text="${os.cliente.nomeFantasia}">Nome Fantasia</span>
        </div>
        <div class="info-row" th:if="${os.cliente.cnpj}">
            <span class="info-label">CNPJ:</span>
            <span th:text="${cliente['cnpjFormatado']}">00.000.000/0000-00</span>
        </div>
        <div class="info-row" th:if="${os.cliente.endereco}">
            <span class="info-label">Endereço:</span>
            <span th:text="${os.cliente.endereco}">Endereço do Cliente</span>
        </div>
        <div class="info-row" th:if="${os.cliente.contato}">
            <span class="info-label">Contato:</span>
            <span th:text="${os.cliente.contato}">Contato</span>
        </div>
        <div class="info-row" th:if="${os.cliente.email}">
            <span class="info-label">Email:</span>
            <span th:text="${os.cliente.email}">email@exemplo.com</span>
        </div>
    </div>

    <!-- Veículos e Serviços -->
    <div class="section-title">Veículos e Serviços</div>

    <div th:each="veiculo, iterStat : ${os.veiculos}" style="margin-bottom: 20px;">
        <table>
            <thead>
                <tr class="veiculo-header">
                    <th colspan="3" style="background: #555;">
                        <span th:text="'Veículo ' + ${iterStat.count} + ': '"></span>
                        <span th:text="${veiculo.placa}" style="font-size: 12pt;">ABC-1234</span>
                        <span th:if="${veiculo.modelo}" th:text="' - ' + ${veiculo.modelo}"></span>
                        <span th:if="${veiculo.cor}" th:text="' (' + ${veiculo.cor} + ')'"></span>
                    </th>
                </tr>
                <tr>
                    <th style="width: 50%;">Serviço/Peça</th>
                    <th style="width: 25%;">Tipo</th>
                    <th style="width: 25%;" class="text-right">Valor</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="peca : ${veiculo.pecas}">
                    <td th:text="${peca.descricao}">Serviço Exemplo</td>
                    <td th:text="${peca.tipoPeca?.nome}">Tipo</td>
                    <td class="text-right" th:text="${#numbers.formatCurrency(peca.valor)}">R$ 0,00</td>
                </tr>
                <tr class="subtotal-row">
                    <td colspan="2">Subtotal do Veículo</td>
                    <td class="text-right" th:text="${#numbers.formatCurrency(veiculo.valorTotal)}">R$ 0,00</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Totais -->
    <div class="total-box">
        <div class="total-row">
            <span class="total-label">Subtotal (sem desconto)</span>
            <span class="total-value" th:text="${#numbers.formatCurrency(os.valorTotalSemDesconto)}">R$ 0,00</span>
        </div>

        <div class="total-row discount-row" th:if="${os.valorDesconto != null and os.valorDesconto > 0}">
            <span class="total-label">
                Desconto
                <span th:if="${os.tipoDesconto?.name() == 'PERCENTUAL'}"
                    th:text="'(' + ${os.valorDesconto} + '%)'"></span>
                <span th:if="${os.tipoDesconto?.name() == 'VALOR_FIXO'}">(Valor Fixo)</span>
            </span>
            <span class="total-value" th:text="'-' + ${#numbers.formatCurrency(descontoCalculado)}">- R$ 0,00</span>
        </div>

        <div class="total-row total-final">
            <span class="total-label">VALOR TOTAL</span>
            <span class="total-value" th:text="${#numbers.formatCurrency(os.valorTotalComDesconto)}">R$ 0,00</span>
        </div>
    </div>

    <!-- Rodapé -->
    <div class="footer">
        Documento gerado automaticamente em <span
            th:text="${#temporals.format(dataGeracao, 'dd/MM/yyyy HH:mm')}"></span>
    </div>
</body>

</html>